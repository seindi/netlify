import vue, {the, lib, library} from "vue.min.js"
import ini from "@/package.json"
let {define} = lib
let {zero, one} = lib

vue.geo = function () {}
vue.geo.location = function (proxy) {
	var geo = {location: new lib.geo.location}
	geo.location.start ()
	vue.on ("mount", function () {
		geo.location.watch (function (position) {
			if (proxy) proxy.value = position
			if (null) vue.geo.location.coordinate.value = position
			if (null) if (the.account.on.line ()) the.map.update (the.account.alias (the.account.doc.id), position.latitude, position.longitude)
			})
		})
	vue.on ("un:mount", function () {
		geo.location.clear ()
		})
	}
vue.geo.location.exist = function (position) {
	if (position.value.latitude === zero) if (position.value.longitude === zero) return false
	else return true
	else return true
	}
vue.geo.location.pos = function (position, number) {
	if (number) return {lat: lib.number (position.value.latitude), lng: lib.number (position.value.longitude)}
	else return {lat: position.value.latitude, lng: position.value.longitude}
	}
vue.geo.location.position = function (position) { return {latitude: position.value.latitude, longitude: position.value.longitude} }
vue.geo.location.save = function (position) { lib.storage.json ("geo:location", {latitude: position.value.latitude, longitude: position.value.longitude}) }
vue.geo.location.extract = function (position) { if (lib.storage.json ("geo:location")) position.value = lib.storage.json ("geo:location") }
vue.geo.location.support = function () { return lib.geo.location.navigator () }
vue.geo.location.coordinate = vue.reference ({latitude: zero, longitude: zero})

vue.map = function () {}
vue.map.option = {zoom: 17, control: {size: null}}
vue.map.start = function (map, element, position, marker, context) {
	var option = {
		center: vue.geo.location.pos (position, true),
		zoom: vue.map.option.zoom,
		controlSize: vue.map.option.control.size,
		}
	map.value = new lib.map (element.value, option, "google")
	if (marker) marker.value = map.value.marker ({position: vue.geo.location.position (position)})
	if (context) context (map, marker)
	}
vue.map.center = function (map, position) {
	if (map.value) map.value.center (vue.geo.location.position (position))
	}
vue.map.marker = function (map, marker, option) {
	option = lib.option (option)
	if (option.position) marker.value.coordinate (vue.geo.location.position (option.position))
	if (option.icon) marker.value.icon (option.icon || lib.google.map.icon.base.src.parking)
	if (option.info_window) {
		marker.value.info_window (option.info_window.title)
		}
	}
